# report-rari-build-issues

The `report-rari-build-issues` reusable action is located at [`.github/workflows/report-rari-build-issues.yml`](https://github.com/mdn/workflows/tree/main/.github/workflows/report-rari-build-issues.yml).

This workflow reports build issues from Rari builds by reading an `issues.json` file and creating GitHub check run annotations for pull requests or workflow command warnings for other contexts.

This reusable action depends on the following actions:

- [github-script](https://github.com/marketplace/actions/github-script)

## Inputs

### Required inputs

The action has the following required inputs:

#### rari-issues-artifact-id

The ID (name) of the artifact containing the `issues.json` file generated by the Rari build process. The workflow will download this artifact and read the issues from it.

- This `input` is required.

#### content-path

The path to the content directory to strip from file paths. This is used to convert absolute file paths in the issues file to repository-relative paths for proper annotation display.

- This `input` is required.

## Usage

In the repository that will call this action, you will need to:

1. Upload the `issues.json` file as an artifact in your build job
2. Call this workflow as a separate job that depends on the build job

### Example for mdn-contributor-spotlight

```yml
name: Build

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Your build steps here...

      - name: Upload build issues
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: build-issues
          path: ${{ env.BUILD_OUT_ROOT }}/issues.json

  report-issues:
    needs: build
    if: always()
    uses: mdn/workflows/.github/workflows/report-rari-build-issues.yml@main
    with:
      rari-issues-artifact-id: build-issues
      content-path: ${{ github.workspace }}/mdn/contributor-spotlight/
```

### Example for generic-content

```yml
name: Build

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Your build steps here...

      - name: Upload build issues
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: build-issues
          path: ${{ env.BUILD_OUT_ROOT }}/issues.json

  report-issues:
    needs: build
    if: always()
    uses: mdn/workflows/.github/workflows/report-rari-build-issues.yml@main
    with:
      rari-issues-artifact-id: build-issues
      content-path: ${{ github.workspace }}/mdn/generic-content/
```

## Behavior

- **For pull requests**: Creates a GitHub check run named "Build Issues" with annotations displayed inline in the Files Changed view. The conclusion is "neutral" if issues are found, "success" otherwise.
- **For non-PR contexts**: Falls back to workflow command warnings that appear in the workflow logs.
- **Annotation limit**: Only the first 50 annotations are displayed in check runs due to GitHub API limitations. All issues are still logged.
